openapi: 3.0.3
info:
  title: Team Task Manager API
  version: 1.0.0
  description: |
    Contract-driven API for Team-based Task Management System.
    Roles supported:
      - MANAGER (Owner)
      - MEMBER

servers:
  - url: http://localhost:8000/api/v1
    description: Local development

tags:
  - name: Health
  - name: Auth
  - name: Projects
  - name: Tasks

paths:
  /health:
    get:
      tags: [Health]
      summary: Health check endpoint
      responses:
        "200":
          description: Service healthy
          content:
            application/json:
              schema:
                type: object
                properties:
                  status:
                    type: string
                    example: ok

  /auth/signup:
    post:
      tags: [Auth]
      summary: Register new user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/SignupRequest"
            example:
              full_name: "Aarav Mehta"
              email: "aarav.mehta@company.com"
              password: "StrongPassword@123"
              role: "MANAGER"
      responses:
        "201":
          description: User registered successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/SignupResponse"
        "400":
          description: Validation error or Email already exists

  /auth/login:
    post:
      tags: [Auth]
      summary: Login user
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/LoginRequest"
            example:
              email: "aarav.mehta@company.com"
              password: "StrongPassword@123"
      responses:
        "200":
          description: Successful login
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TokenResponse"
        "401":
          description: Invalid credentials

  /projects:
    post:
      tags: [Projects]
      summary: Create project
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectCreate"
            example:
              name: "Internal CRM System"
              description: "CRM system for managing internal client workflows"
      responses:
        "201":
          description: Project created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResponse"
        "401":
          description: Unauthorized

    get:
      tags: [Projects]
      summary: List projects for authenticated user
      security:
        - bearerAuth: []
      responses:
        "200":
          description: List of projects
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/ProjectResponse"
        "401":
          description: Unauthorized

  /projects/{project_id}:
    get:
      tags: [Projects]
      summary: Get project details
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Project details
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResponse"
        "403":
          description: Forbidden
        "404":
          description: Not found

    put:
      tags: [Projects]
      summary: Update project
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectUpdate"
      responses:
        "200":
          description: Project updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectResponse"
        "403":
          description: Forbidden

    delete:
      tags: [Projects]
      summary: Delete project
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Deleted successfully
        "403":
          description: Forbidden

  /projects/{project_id}/members:
    get:
      tags: [Projects]
      summary: List project members
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: List of project members
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/ProjectMemberListResponse'
        "403":
          description: Forbidden

    post:
      tags: [Projects]
      summary: Add member to project
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/ProjectMemberAdd"
      responses:
        "201":
          description: Member added successfully
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ProjectMemberResponse"
        "400":
          description: Already a member
        "403":
          description: Forbidden

  /projects/{project_id}/members/{user_id}:
    delete:
      tags: [Projects]
      summary: Remove member from project
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: path
          required: true
          schema:
            type: string
        - name: user_id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Member removed successfully
        "403":
          description: Forbidden

  /tasks:
    post:
      tags: [Tasks]
      summary: Create task
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TaskCreate"
            example:
              project_id: "uuid-project-123"
              title: "Design database schema"
              description: "Create normalized schema with relationships"
              status: "PENDING"
      responses:
        "201":
          description: Task created
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskResponse"
        "403":
          description: Forbidden

    get:
      tags: [Tasks]
      summary: List tasks for a project
      security:
        - bearerAuth: []
      parameters:
        - name: project_id
          in: query
          required: true
          schema:
            type: string
      responses:
        "200":
          description: List of tasks. Owners get member tracking info.
          content:
            application/json:
              schema:
                type: array
                items:
                  oneOf:
                    - $ref: "#/components/schemas/TaskOwnerResponse"
                    - $ref: "#/components/schemas/TaskResponse"
        "403":
          description: Forbidden

  /tasks/{task_id}:
    get:
      tags: [Tasks]
      summary: Get task details
      security:
        - bearerAuth: []
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
      responses:
        "200":
          description: Task details. Owners get member tracking info.
          content:
            application/json:
              schema:
                oneOf:
                  - $ref: "#/components/schemas/TaskOwnerResponse"
                  - $ref: "#/components/schemas/TaskResponse"
        "403":
          description: Forbidden
        "404":
          description: Not found

    patch:
      tags: [Tasks]
      summary: Update task status or metadata
      security:
        - bearerAuth: []
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/TaskUpdate"
      responses:
        "200":
          description: Task updated
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TaskResponse"
        "403":
          description: Forbidden

    delete:
      tags: [Tasks]
      summary: Delete task (Creator only)
      security:
        - bearerAuth: []
      parameters:
        - name: task_id
          in: path
          required: true
          schema:
            type: string
      responses:
        "204":
          description: Deleted successfully
        "403":
          description: Forbidden

components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    SignupRequest:
      type: object
      required: [full_name, email, password, role]
      properties:
        full_name:
          type: string
        email:
          type: string
          format: email
        password:
          type: string
          minLength: 8
        role:
          type: string
          enum: [MANAGER, MEMBER]

    SignupResponse:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        full_name:
          type: string
        role:
          type: string

    LoginRequest:
      type: object
      required: [email, password]
      properties:
        email:
          type: string
        password:
          type: string

    TokenResponse:
      type: object
      properties:
        access_token:
          type: string
        token_type:
          type: string

    ProjectCreate:
      type: object
      required: [name]
      properties:
        name:
          type: string
        description:
          type: string

    ProjectResponse:
      type: object
      properties:
        id:
          type: string
        name:
          type: string
        description:
          type: string
        owner_id:
          type: string
        created_at:
          type: string
          format: date-time

    ProjectUpdate:
      type: object
      properties:
        name:
          type: string
        description:
          type: string

    ProjectMemberUserInfo:
      type: object
      properties:
        id:
          type: string
        email:
          type: string
        full_name:
          type: string
      required: [id, email]

    ProjectMemberListResponse:
      type: object
      properties:
        id:
          type: string
        project_id:
          type: string
        joined_at:
          type: string
          format: date-time
        user:
          $ref: '#/components/schemas/ProjectMemberUserInfo'

    ProjectMemberAdd:
      type: object
      required: [user_id]
      properties:
        user_id:
          type: string

    ProjectMemberResponse:
      type: object
      properties:
        id:
          type: string
        project_id:
          type: string
        user_id:
          type: string
        joined_at:
          type: string
          format: date-time

    TaskCreate:
      type: object
      required: [project_id, title, description, status]
      properties:
        project_id:
          type: string
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [ACTIVE, PENDING, COMPLETE]

    TaskUpdate:
      type: object
      properties:
        title:
          type: string
        description:
          type: string
        status:
          type: string
          enum: [ACTIVE, PENDING, COMPLETE]

    TaskResponse:
      type: object
      properties:
        id:
          type: string
        project_id:
          type: string
        created_by_id:
          type: string
        title:
          type: string
        description:
          type: string
        status:
          type: string
        created_at:
          type: string
          format: date-time
        updated_at:
          type: string
          format: date-time

    MemberTaskStatus:
      type: object
      properties:
        user_id:
          type: string
        full_name:
          type: string
        status:
          type: string
        updated_at:
          type: string
          format: date-time

    TaskOwnerResponse:
      allOf:
        - $ref: "#/components/schemas/TaskResponse"
        - type: object
          properties:
            member_statuses:
              type: array
              items:
                $ref: "#/components/schemas/MemberTaskStatus"
